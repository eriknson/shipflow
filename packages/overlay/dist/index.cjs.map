{"version":3,"sources":["../src/index.ts","../src/runtime/FlowOverlay.tsx","../src/runtime/constants.ts","../src/runtime/loadReactGrabRuntime.ts","../src/runtime/registerClipboardInterceptor.ts"],"sourcesContent":["export {\n  FlowOverlayProvider,\n  Typewriter,\n  type FlowOverlayProps,\n} from \"./runtime/FlowOverlay\";\nexport {\n  registerClipboardInterceptor,\n  type ClipboardInterceptorOptions,\n} from \"./runtime/registerClipboardInterceptor\";\nexport { loadReactGrabRuntime } from \"./runtime/loadReactGrabRuntime\";\nexport {\n  DEFAULT_MODEL_OPTIONS,\n  DEFAULT_STATUS_SEQUENCE,\n} from \"./runtime/constants\";\nexport type {\n  ModelOption,\n  ShipflowOverlayConfig,\n  StatusSequence,\n} from \"./runtime/types\";\n// Server exports (createNextHandler) are only available via @shipflow/overlay/next\n// to avoid bundling Node.js modules (child_process, fs) into client code\n\n\n\n","'use client';\n\nimport {\n  type CSSProperties,\n  type ChangeEvent,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n  type KeyboardEvent as ReactKeyboardEvent,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { ArrowUp, Square, Command } from \"lucide-react\";\n\nimport { DEFAULT_MODEL_OPTIONS, DEFAULT_STATUS_SEQUENCE } from \"./constants\";\nimport type {\n  ModelOption,\n  SelectionPayload,\n  ShipflowOverlayConfig,\n  StatusAddonMode,\n  StatusSequence,\n  StreamEvent,\n} from \"./types\";\nimport { loadReactGrabRuntime } from \"./loadReactGrabRuntime\";\nimport {\n  registerClipboardInterceptor,\n  type ClipboardInterceptorOptions,\n} from \"./registerClipboardInterceptor\";\n\nconst HIGHLIGHT_QUERY = \"[data-react-grab-chat-highlighted='true']\";\nconst OVERLAY_STYLE_ID = \"shipflow-overlay-styles\";\nconst OVERLAY_ROOT_ID = \"shipflow-overlay-root\";\n\ntype OverlayMount = {\n  container: HTMLElement;\n  root: ShadowRoot | HTMLElement;\n};\n\nconst ensureOverlayStyles = (root: Document | ShadowRoot) => {\n  if (\"getElementById\" in root && root.getElementById(OVERLAY_STYLE_ID)) {\n    return;\n  }\n\n  const style = document.createElement(\"style\");\n  style.id = OVERLAY_STYLE_ID;\n  style.textContent = `\n:host {\n  font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n  line-height: 1.5;\n  color: var(--sf-text);\n  font-size: 14px;\n  --sf-bg: rgba(250, 250, 250, 0.7);\n  --sf-border: rgba(229, 229, 229, 0.5);\n  --sf-text: #171717;\n  --sf-muted-text: #6b7280;\n  --sf-placeholder: #9ca3af;\n  --sf-inline-bg: rgba(212, 212, 212, 0.6);\n  --sf-inline-hover-bg: rgba(212, 212, 212, 0.85);\n  --sf-inline-text: #4b5563;\n  --sf-inline-disabled-opacity: 0.5;\n  --sf-select-bg: transparent;\n  --sf-select-hover-bg: rgba(212, 212, 212, 0.25);\n  --sf-select-text: #4b5563;\n  --sf-focus-ring: rgba(212, 212, 212, 0.5);\n  --sf-submit-bg: #171717;\n  --sf-submit-hover-bg: #262626;\n  --sf-submit-text: #ffffff;\n  --sf-status-bg: rgba(245, 245, 245, 0.45);\n  --sf-status-border: rgba(229, 229, 229, 0.3);\n  --sf-error-bg: rgba(254, 242, 242, 0.6);\n  --sf-error-border: rgba(254, 202, 202, 0.5);\n  --sf-error-text: #dc2626;\n  --sf-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n  --sf-body-gap: 0.5rem;\n}\n\n@media (prefers-color-scheme: dark) {\n  :host {\n    --sf-bg: rgba(23, 23, 23, 0.75);\n    --sf-border: rgba(64, 64, 64, 0.5);\n    --sf-text: #f5f5f5;\n    --sf-muted-text: #a3a3a3;\n    --sf-placeholder: #737373;\n    --sf-inline-bg: rgba(64, 64, 64, 0.5);\n    --sf-inline-hover-bg: rgba(64, 64, 64, 0.8);\n    --sf-inline-text: #e5e5e5;\n    --sf-select-bg: transparent;\n    --sf-select-hover-bg: rgba(64, 64, 64, 0.3);\n    --sf-select-text: #a3a3a3;\n    --sf-focus-ring: rgba(64, 64, 64, 0.5);\n    --sf-submit-bg: #f5f5f5;\n    --sf-submit-hover-bg: #e5e5e5;\n    --sf-submit-text: #111827;\n    --sf-status-bg: rgba(23, 23, 23, 0.35);\n    --sf-status-border: rgba(64, 64, 64, 0.4);\n    --sf-error-bg: rgba(239, 68, 68, 0.18);\n    --sf-error-border: rgba(239, 68, 68, 0.35);\n    --sf-error-text: #fecaca;\n    --sf-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);\n  }\n}\n\n:host([data-theme=\"dark\"]),\n:host-context(.dark) {\n  --sf-bg: rgba(23, 23, 23, 0.75);\n  --sf-border: rgba(64, 64, 64, 0.5);\n  --sf-text: #f5f5f5;\n  --sf-muted-text: #a3a3a3;\n  --sf-placeholder: #737373;\n  --sf-inline-bg: rgba(64, 64, 64, 0.5);\n  --sf-inline-hover-bg: rgba(64, 64, 64, 0.8);\n  --sf-inline-text: #e5e5e5;\n  --sf-select-bg: rgba(38, 38, 38, 0.6);\n  --sf-select-hover-bg: rgba(38, 38, 38, 0.8);\n  --sf-select-text: #d4d4d4;\n  --sf-focus-ring: rgba(64, 64, 64, 0.5);\n  --sf-submit-bg: #f5f5f5;\n  --sf-submit-hover-bg: #e5e5e5;\n  --sf-submit-text: #111827;\n  --sf-status-bg: rgba(23, 23, 23, 0.35);\n  --sf-status-border: rgba(64, 64, 64, 0.4);\n  --sf-error-bg: rgba(239, 68, 68, 0.18);\n  --sf-error-border: rgba(239, 68, 68, 0.35);\n  --sf-error-text: #fecaca;\n  --sf-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);\n}\n\n:host *,\n:host *::before,\n:host *::after {\n  box-sizing: border-box;\n  font-family: inherit;\n}\n\n[data-react-grab-chat-bubble=\"true\"] {\n  position: fixed;\n  z-index: 2147483647;\n  display: flex;\n  width: 100%;\n  max-width: 400px;\n  flex-direction: column;\n  overflow: hidden;\n  border-radius: 12px;\n  border: 1px solid var(--sf-border);\n  background: var(--sf-bg);\n  color: var(--sf-text);\n  box-shadow: var(--sf-shadow);\n  backdrop-filter: blur(24px);\n  -webkit-backdrop-filter: blur(24px);\n  animation: shipflow-fade-in 120ms ease-out;\n  pointer-events: auto;\n}\n\n[data-sf-body=\"true\"] {\n  display: flex;\n  flex-direction: column;\n  gap: var(--sf-body-gap);\n  padding: 12px;\n}\n\n[data-sf-body=\"true\"][data-expanded=\"false\"] {\n  --sf-body-gap: 0;\n}\n\n[data-sf-row=\"input\"] {\n  display: flex;\n  align-items: center;\n  position: relative;\n}\n\n[data-sf-input=\"true\"] {\n  width: 100%;\n  resize: none;\n  border: none;\n  background: transparent;\n  color: var(--sf-text);\n  font-size: 0.875rem;\n  line-height: 1.6;\n  padding-right: 2.5rem;\n  outline: none;\n}\n\n[data-sf-input=\"true\"][data-expanded=\"true\"] {\n  padding-right: 0;\n}\n\n[data-sf-input=\"true\"]::placeholder {\n  color: var(--sf-placeholder);\n}\n\n[data-sf-input=\"true\"][disabled] {\n  opacity: 0.6;\n}\n\n[data-sf-inline-submit=\"true\"] {\n  position: absolute;\n  right: 0;\n  top: 50%;\n  transform: translateY(-50%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 2rem;\n  width: 2rem;\n  border-radius: 9999px;\n  background: var(--sf-inline-bg);\n  color: var(--sf-inline-text);\n  border: none;\n  cursor: pointer;\n  transition: background-color 150ms ease, transform 150ms ease, opacity 150ms ease;\n}\n\n[data-sf-inline-submit=\"true\"]:hover:not([disabled]) {\n  background: var(--sf-inline-hover-bg);\n}\n\n[data-sf-inline-submit=\"true\"][disabled] {\n  opacity: var(--sf-inline-disabled-opacity);\n  cursor: default;\n}\n\n[data-sf-toolbar=\"true\"] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n}\n\n[data-sf-select-wrapper=\"true\"] {\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n}\n\n[data-sf-select=\"true\"] {\n  height: 2rem;\n  appearance: none;\n  border-radius: 8px;\n  border: none;\n  background: var(--sf-select-bg);\n  color: var(--sf-select-text);\n  padding: 0 26px 0 12px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: background-color 150ms ease, box-shadow 150ms ease;\n}\n\n[data-sf-select=\"true\"]:hover:not([disabled]) {\n  background: var(--sf-select-hover-bg);\n}\n\n[data-sf-select=\"true\"]:focus-visible {\n  outline: none;\n  box-shadow: 0 0 0 2px var(--sf-focus-ring);\n}\n\n[data-sf-select=\"true\"][disabled] {\n  opacity: 0.55;\n  cursor: default;\n}\n\n[data-sf-select-chevron=\"true\"] {\n  position: absolute;\n  pointer-events: none;\n  right: 10px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: var(--sf-placeholder);\n}\n\n[data-sf-submit=\"true\"] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 2rem;\n  width: 2rem;\n  border-radius: 9999px;\n  border: none;\n  cursor: pointer;\n  background: var(--sf-submit-bg);\n  color: var(--sf-submit-text);\n  transition: transform 150ms ease, background-color 150ms ease, opacity 150ms ease;\n}\n\n[data-sf-submit=\"true\"]:hover:not([disabled]) {\n  background: var(--sf-submit-hover-bg);\n  transform: scale(1.05);\n}\n\n[data-sf-submit=\"true\"][disabled] {\n  opacity: 0.65;\n  cursor: default;\n  transform: scale(1);\n}\n\n[data-sf-submit=\"true\"][data-hidden=\"true\"] {\n  opacity: 0;\n  pointer-events: none;\n}\n\n[data-sf-status=\"true\"] {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  border-top: 1px solid var(--sf-status-border);\n  background: var(--sf-status-bg);\n  padding: 10px 12px;\n  backdrop-filter: blur(24px);\n  -webkit-backdrop-filter: blur(24px);\n}\n\n[data-sf-status=\"true\"][data-mode=\"progress\"] {\n  font-size: 0.75rem;\n  font-weight: 500;\n  color: var(--sf-muted-text);\n}\n\n[data-sf-status-header=\"true\"] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n}\n\n[data-sf-status-label=\"true\"] {\n  display: inline-flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 500;\n  font-size: 0.75rem;\n  color: var(--sf-muted-text);\n  flex-shrink: 0;\n}\n\n[data-sf-status-context=\"true\"] {\n  flex: 1 1 auto;\n  min-width: 0;\n  text-align: right;\n  color: var(--sf-muted-text);\n  font-size: 0.75rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n[data-sf-status=\"true\"][data-mode=\"summary\"] {\n  font-size: 0.75rem;\n  font-weight: 500;\n  color: var(--sf-muted-text);\n}\n\n[data-sf-status=\"true\"][data-mode=\"summary\"] [data-sf-status-header=\"true\"] {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n}\n\n[data-sf-status=\"true\"][data-mode=\"summary\"] [data-sf-undo=\"true\"] {\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n  border: none;\n  background: transparent;\n  color: var(--sf-muted-text);\n  cursor: pointer;\n  padding: 0;\n  font-size: 0.75rem;\n  transition: color 120ms ease;\n}\n\n[data-sf-status=\"true\"][data-mode=\"summary\"] [data-sf-undo=\"true\"]:hover {\n  color: var(--sf-text);\n}\n\n[data-sf-undo-wrapper=\"true\"] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n[data-sf-undo=\"true\"] svg {\n  width: 12px;\n  height: 12px;\n}\n\n[data-sf-error=\"true\"] {\n  border-top: 1px solid var(--sf-error-border);\n  background: var(--sf-error-bg);\n  color: var(--sf-error-text);\n  font-size: 0.75rem;\n  font-weight: 600;\n  padding: 10px 12px;\n}\n\n[data-sf-icon=\"cursor\"] {\n  width: 14px;\n  height: 14px;\n}\n\n[data-sf-icon=\"cursor\"][data-loading=\"true\"] {\n  animation: shipflow-pulse 1.5s ease-in-out infinite;\n}\n\n[data-sf-inline-submit=\"true\"] svg,\n[data-sf-submit=\"true\"] svg {\n  width: 14px;\n  height: 14px;\n}\n\n[data-sf-submit=\"true\"][data-submitting=\"true\"] svg {\n  width: 12px;\n  height: 12px;\n  fill: currentColor;\n}\n\n[data-sf-shimmer=\"true\"] {\n  background: linear-gradient(90deg, var(--sf-muted-text), transparent, var(--sf-muted-text));\n  background-size: 200% 100%;\n  -webkit-background-clip: text;\n  background-clip: text;\n  color: transparent;\n  animation: shipflow-shimmer 2.4s linear infinite;\n  opacity: 0.75;\n}\n\n@keyframes shipflow-fade-in {\n  from {\n    opacity: 0;\n    transform: translateY(4px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes shipflow-shimmer {\n  0% { background-position: 200% 0; }\n  100% { background-position: -200% 0; }\n}\n\n@keyframes shipflow-pulse {\n  0%, 100% { opacity: 0.6; }\n  50% { opacity: 0.25; }\n}\n`;\n\n  const target: ParentNode =\n    root instanceof Document\n      ? root.head ?? root.body ?? root.documentElement ?? root\n      : root;\n  target.appendChild(style);\n};\n\nconst getOrCreateOverlayMount = (): OverlayMount | null => {\n  if (typeof document === \"undefined\") {\n    return null;\n  }\n\n  let container = document.getElementById(OVERLAY_ROOT_ID) as HTMLElement | null;\n  if (!container) {\n    container = document.createElement(\"div\");\n    container.id = OVERLAY_ROOT_ID;\n    container.style.position = \"fixed\";\n    container.style.top = \"0\";\n    container.style.left = \"0\";\n    container.style.width = \"0\";\n    container.style.height = \"0\";\n    container.style.zIndex = \"2147483646\";\n    document.body.appendChild(container);\n  }\n\n  let root: ShadowRoot | HTMLElement;\n  if (typeof container.attachShadow === \"function\") {\n    root = container.shadowRoot ?? container.attachShadow({ mode: \"open\" });\n  } else {\n    root = container;\n  }\n\n  return { container, root };\n};\nconst EVENT_OPEN = \"react-grab-chat:open\";\nconst EVENT_CLOSE = \"react-grab-chat:close\";\nconst EVENT_UNDO = \"react-grab-chat:undo\";\n\nconst DEFAULT_CONFIG: ShipflowOverlayConfig = {\n  endpoint: \"/api/shipflow/overlay\",\n  models: DEFAULT_MODEL_OPTIONS,\n  statusSequence: DEFAULT_STATUS_SEQUENCE,\n};\n\ntype ChatState = SelectionPayload & {\n  instruction: string;\n  status: \"idle\" | \"submitting\" | \"success\" | \"error\";\n  error?: string;\n  serverMessage?: string;\n  model: string;\n  statusPhase: number;\n  statusAddonMode: StatusAddonMode;\n  statusLabel: string | null;\n  statusContext: string | null;\n  useTypewriter: boolean;\n  summary?: string;\n};\n\nconst DEFAULT_BUBBLE_STYLE: CSSProperties = {\n  top: \"20%\",\n  left: \"50%\",\n  transform: \"translate(-50%, -50%)\",\n};\n\nconst VIEWPORT_MARGIN = 12;\nconst ANCHOR_GAP = 24;\nconst POINTER_HORIZONTAL_GAP = 16;\nconst POINTER_VERTICAL_OFFSET = 12;\n\nconst createInitialState = (\n  models: readonly ModelOption[],\n  statusSequence: StatusSequence,\n): ChatState => ({\n  htmlFrame: null,\n  codeLocation: null,\n  filePath: null,\n  clipboardData: \"\",\n  pointer: null,\n  boundingRect: null,\n  instruction: \"\",\n  status: \"idle\",\n  serverMessage: undefined,\n  error: undefined,\n  model: models[0]?.value ?? \"\",\n  statusPhase: 0,\n  statusAddonMode: \"idle\",\n  statusLabel: statusSequence[0] ?? null,\n  statusContext: null,\n  useTypewriter: true,\n  summary: undefined,\n});\n\nexport type FlowOverlayProps = Partial<ShipflowOverlayConfig> & {\n  enableClipboardInterceptor?: boolean;\n  clipboardOptions?: ClipboardInterceptorOptions;\n};\n\nfunction CursorIcon({ loading }: { loading?: boolean }) {\n  return (\n    <svg\n      viewBox=\"0 0 466.73 533.32\"\n      data-sf-icon=\"cursor\"\n      data-loading={loading ? \"true\" : undefined}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      shapeRendering=\"geometricPrecision\"\n    >\n      <path fill=\"#72716d\" d=\"M233.37,266.66l231.16,133.46c-1.42,2.46-3.48,4.56-6.03,6.03l-216.06,124.74c-5.61,3.24-12.53,3.24-18.14,0L8.24,406.15c-2.55-1.47-4.61-3.57-6.03-6.03l231.16-133.46h0Z\" />\n      <path fill=\"#55544f\" d=\"M233.37,0v266.66L2.21,400.12c-1.42-2.46-2.21-5.3-2.21-8.24v-250.44c0-5.89,3.14-11.32,8.24-14.27L224.29,2.43c2.81-1.62,5.94-2.43,9.07-2.43h.01Z\" />\n      <path fill=\"#43413c\" d=\"M464.52,133.2c-1.42-2.46-3.48-4.56-6.03-6.03L242.43,2.43c-2.8-1.62-5.93-2.43-9.06-2.43v266.66l231.16,133.46c1.42-2.46,2.21-5.3,2.21-8.24v-250.44c0-2.95-.78-5.77-2.21-8.24h-.01Z\" />\n      <path fill=\"#d6d5d2\" d=\"M448.35,142.54c1.31,2.26,1.49,5.16,0,7.74l-209.83,363.42c-1.41,2.46-5.16,1.45-5.16-1.38v-239.48c0-1.91-.51-3.75-1.44-5.36l216.42-124.95h.01Z\" />\n      <path fill=\"#fff\" d=\"M448.35,142.54l-216.42,124.95c-.92-1.6-2.26-2.96-3.92-3.92L20.62,143.83c-2.46-1.41-1.45-5.16,1.38-5.16h419.65c2.98,0,5.4,1.61,6.7,3.87Z\" />\n    </svg>\n  );\n}\n\nfunction useSelectionEvents(\n  onOpen: (payload: SelectionPayload) => void,\n  onClose: () => void,\n  isOpen: boolean,\n) {\n  useEffect(() => {\n    const handler = (event: Event) => {\n      const custom = event as CustomEvent<SelectionPayload>;\n      if (!custom.detail) return;\n\n      if (isOpen) {\n        onClose();\n      }\n\n      onOpen(custom.detail);\n    };\n\n    window.addEventListener(EVENT_OPEN, handler as EventListener);\n    return () => window.removeEventListener(EVENT_OPEN, handler as EventListener);\n  }, [onOpen, onClose, isOpen]);\n}\n\nfunction useRecalculateRect(\n  chat: ChatState | null,\n  setChat: React.Dispatch<React.SetStateAction<ChatState | null>>,\n) {\n  useEffect(() => {\n    if (!chat) return;\n\n    const updateRect = () => {\n      const element = document.querySelector(HIGHLIGHT_QUERY);\n\n      if (!(element instanceof HTMLElement)) {\n        setChat((current) => {\n          if (!current || current.boundingRect === null) {\n            return current;\n          }\n          return { ...current, boundingRect: null };\n        });\n        return;\n      }\n\n      const rect = element.getBoundingClientRect();\n      const scrollX = window.scrollX;\n      const scrollY = window.scrollY;\n\n      const nextRect = {\n        top: rect.top + scrollY,\n        left: rect.left + scrollX,\n        width: rect.width,\n        height: rect.height,\n      };\n\n      setChat((current) => {\n        if (!current) {\n          return current;\n        }\n\n        const prev = current.boundingRect;\n        const hasChanged =\n          !prev ||\n          prev.top !== nextRect.top ||\n          prev.left !== nextRect.left ||\n          prev.width !== nextRect.width ||\n          prev.height !== nextRect.height;\n\n        if (!hasChanged) {\n          return current;\n        }\n\n        return {\n          ...current,\n          boundingRect: nextRect,\n        };\n      });\n    };\n\n    updateRect();\n    window.addEventListener(\"scroll\", updateRect, true);\n    window.addEventListener(\"resize\", updateRect);\n\n    return () => {\n      window.removeEventListener(\"scroll\", updateRect, true);\n      window.removeEventListener(\"resize\", updateRect);\n    };\n  }, [chat, setChat]);\n}\n\nfunction useEscapeToClose(isOpen: boolean, onClose: () => void) {\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handler = (event: KeyboardEvent) => {\n      if (event.key === \"Escape\") {\n        event.preventDefault();\n        onClose();\n      }\n    };\n\n    window.addEventListener(\"keydown\", handler, true);\n    return () => window.removeEventListener(\"keydown\", handler, true);\n  }, [isOpen, onClose]);\n}\n\nfunction useAutoFocus(isOpen: boolean, shadowRoot: ShadowRoot | HTMLElement | null) {\n  useEffect(() => {\n    if (!isOpen || !shadowRoot) return;\n\n    const frame = requestAnimationFrame(() => {\n      // Query within shadow root for Shadow DOM support\n      const root = shadowRoot instanceof ShadowRoot ? shadowRoot : document;\n      const textarea = root.querySelector<HTMLTextAreaElement>(\n        \"[data-react-grab-chat-input='true']\",\n      );\n      textarea?.focus();\n    });\n\n    return () => cancelAnimationFrame(frame);\n  }, [isOpen, shadowRoot]);\n}\n\nfunction useClickOutside(\n  ref: React.RefObject<HTMLElement | null>,\n  isOpen: boolean,\n  onClose: () => void,\n) {\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleClickOutside = (event: MouseEvent) => {\n      // Use composedPath to get the full event path including Shadow DOM elements\n      const path = event.composedPath();\n      const clickedInsideBubble = ref.current && path.includes(ref.current);\n      \n      if (clickedInsideBubble) {\n        return;\n      }\n\n      const highlightedElement = document.querySelector(HIGHLIGHT_QUERY);\n      const clickedInsideHighlight = highlightedElement && path.includes(highlightedElement);\n      \n      if (!clickedInsideHighlight) {\n        onClose();\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside, true);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside, true);\n    };\n  }, [ref, isOpen, onClose]);\n}\n\nfunction Typewriter({ text }: { text: string }) {\n  const [displayed, setDisplayed] = useState(\"\");\n\n  useEffect(() => {\n    setDisplayed(\"\");\n    let i = 0;\n    const timer = setInterval(() => {\n      if (i < text.length) {\n        setDisplayed(text.slice(0, i + 1));\n        i++;\n      } else {\n        clearInterval(timer);\n      }\n    }, 15);\n    return () => clearInterval(timer);\n  }, [text]);\n\n  return <>{displayed}</>;\n}\n\nfunction Bubble({\n  chat,\n  onInstructionChange,\n  onSubmit,\n  onStop,\n  onModelChange,\n  onClose,\n  modelOptions,\n  statusSequence,\n}: {\n  chat: ChatState;\n  onInstructionChange: (value: string) => void;\n  onSubmit: () => void;\n  onStop: () => void;\n  onModelChange: (value: string) => void;\n  onClose: () => void;\n  modelOptions: readonly ModelOption[];\n  statusSequence: StatusSequence;\n}) {\n  const anchor = chat.boundingRect;\n  const bubbleRef = useRef<HTMLDivElement | null>(null);\n  const [bubbleSize, setBubbleSize] = useState<{ width: number; height: number } | null>(null);\n  const [bubbleStyle, setBubbleStyle] = useState<CSSProperties>(DEFAULT_BUBBLE_STYLE);\n  const textareaRef = useRef<HTMLTextAreaElement | null>(null);\n\n  useClickOutside(bubbleRef, true, onClose);\n\n  useLayoutEffect(() => {\n    const node = bubbleRef.current;\n    if (!node) return;\n\n    const updateSize = () => {\n      const rect = node.getBoundingClientRect();\n      setBubbleSize((prev) => {\n        if (prev && prev.width === rect.width && prev.height === rect.height) {\n          return prev;\n        }\n        return { width: rect.width, height: rect.height };\n      });\n    };\n\n    updateSize();\n\n    if (typeof ResizeObserver !== \"undefined\") {\n      const observer = new ResizeObserver(() => {\n        updateSize();\n      });\n      observer.observe(node);\n      return () => observer.disconnect();\n    }\n\n    window.addEventListener(\"resize\", updateSize);\n    return () => {\n      window.removeEventListener(\"resize\", updateSize);\n    };\n  }, []);\n\n  useLayoutEffect(() => {\n    if (!bubbleSize) {\n      setBubbleStyle((prev) => (prev === DEFAULT_BUBBLE_STYLE ? prev : DEFAULT_BUBBLE_STYLE));\n      return;\n    }\n\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n    const scrollX = window.scrollX;\n    const scrollY = window.scrollY;\n    const verticalGap = ANCHOR_GAP;\n    const horizontalGap = ANCHOR_GAP;\n\n    const clampHorizontal = (value: number) => {\n      const min = VIEWPORT_MARGIN;\n      const max = viewportWidth - VIEWPORT_MARGIN - bubbleSize.width;\n      if (min > max) {\n        return (viewportWidth - bubbleSize.width) / 2;\n      }\n      return Math.min(Math.max(value, min), max);\n    };\n\n    const clampVertical = (value: number) => {\n      const min = VIEWPORT_MARGIN;\n      const max = viewportHeight - VIEWPORT_MARGIN - bubbleSize.height;\n      if (min > max) {\n        return (viewportHeight - bubbleSize.height) / 2;\n      }\n      return Math.min(Math.max(value, min), max);\n    };\n\n    const computeOverflow = (top: number, left: number) => {\n      const overflowTop = Math.max(VIEWPORT_MARGIN - top, 0);\n      const overflowBottom = Math.max(\n        top + bubbleSize.height - (viewportHeight - VIEWPORT_MARGIN),\n        0,\n      );\n      const overflowLeft = Math.max(VIEWPORT_MARGIN - left, 0);\n      const overflowRight = Math.max(\n        left + bubbleSize.width - (viewportWidth - VIEWPORT_MARGIN),\n        0,\n      );\n\n      return overflowTop + overflowBottom + overflowLeft + overflowRight;\n    };\n\n    const pointer = chat.pointer;\n    let bestStyle: CSSProperties | null = null;\n\n    if (anchor) {\n      const anchorViewport = {\n        top: anchor.top - scrollY,\n        left: anchor.left - scrollX,\n        width: anchor.width,\n        height: anchor.height,\n      };\n\n      const anchorCenterX = anchorViewport.left + anchorViewport.width / 2;\n      const anchorCenterY = anchorViewport.top + anchorViewport.height / 2;\n\n      type CandidateName = \"bottom\" | \"top\" | \"right\" | \"left\";\n\n      type Candidate = {\n        name: CandidateName;\n        top: number;\n        left: number;\n        fits: boolean;\n        overflow: number;\n      };\n\n      const candidates: Candidate[] = [];\n\n      const bottomTop = anchorViewport.top + anchorViewport.height + verticalGap;\n      const bottomLeft = clampHorizontal(anchorCenterX - bubbleSize.width / 2);\n      candidates.push({\n        name: \"bottom\",\n        top: bottomTop,\n        left: bottomLeft,\n        fits: bottomTop + bubbleSize.height <= viewportHeight - VIEWPORT_MARGIN,\n        overflow: computeOverflow(bottomTop, bottomLeft),\n      });\n\n      const topTop = anchorViewport.top - verticalGap - bubbleSize.height;\n      const topLeft = clampHorizontal(anchorCenterX - bubbleSize.width / 2);\n      candidates.push({\n        name: \"top\",\n        top: topTop,\n        left: topLeft,\n        fits: topTop >= VIEWPORT_MARGIN,\n        overflow: computeOverflow(topTop, topLeft),\n      });\n\n      const rightLeft = anchorViewport.left + anchorViewport.width + horizontalGap;\n      const rightTop = clampVertical(anchorCenterY - bubbleSize.height / 2);\n      candidates.push({\n        name: \"right\",\n        top: rightTop,\n        left: rightLeft,\n        fits: rightLeft + bubbleSize.width <= viewportWidth - VIEWPORT_MARGIN,\n        overflow: computeOverflow(rightTop, rightLeft),\n      });\n\n      const leftLeft = anchorViewport.left - horizontalGap - bubbleSize.width;\n      const leftTop = clampVertical(anchorCenterY - bubbleSize.height / 2);\n      candidates.push({\n        name: \"left\",\n        top: leftTop,\n        left: leftLeft,\n        fits: leftLeft >= VIEWPORT_MARGIN,\n        overflow: computeOverflow(leftTop, leftLeft),\n      });\n\n      const baseOrder: CandidateName[] = [\"bottom\", \"top\", \"right\", \"left\"];\n      const orderedCandidates = baseOrder\n        .map((name) => candidates.find((candidate) => candidate.name === name))\n        .filter((candidate): candidate is Candidate => Boolean(candidate));\n\n      const perfectCandidate = orderedCandidates.find(\n        (candidate) => candidate.fits && candidate.overflow === 0,\n      );\n\n      if (perfectCandidate) {\n        bestStyle = {\n          top: `${Math.round(perfectCandidate.top)}px`,\n          left: `${Math.round(perfectCandidate.left)}px`,\n        };\n      } else if (!pointer) {\n        const bestCandidate =\n          orderedCandidates.find((candidate) => candidate.fits) ??\n          (orderedCandidates.length > 0\n            ? orderedCandidates.reduce(\n                (best, candidate) => (candidate.overflow < best.overflow ? candidate : best),\n                orderedCandidates[0],\n              )\n            : null);\n\n        if (bestCandidate) {\n          bestStyle = {\n            top: `${Math.round(bestCandidate.top)}px`,\n            left: `${Math.round(bestCandidate.left)}px`,\n          };\n        }\n      }\n    }\n\n    if (!bestStyle && pointer) {\n      const pointerTopRaw = pointer.y - POINTER_VERTICAL_OFFSET;\n      const clampedTop = clampVertical(pointerTopRaw);\n\n      const rightLeftRaw = pointer.x + POINTER_HORIZONTAL_GAP;\n      const fitsRight = rightLeftRaw + bubbleSize.width <= viewportWidth - VIEWPORT_MARGIN;\n\n      let targetLeft = rightLeftRaw;\n      if (!fitsRight) {\n        const leftLeftRaw = pointer.x - POINTER_HORIZONTAL_GAP - bubbleSize.width;\n        targetLeft = leftLeftRaw;\n      }\n\n      const clampedLeft = clampHorizontal(targetLeft);\n\n      bestStyle = {\n        top: `${Math.round(clampedTop)}px`,\n        left: `${Math.round(clampedLeft)}px`,\n      };\n    }\n\n    if (bestStyle) {\n      setBubbleStyle((prev) => {\n        if (\n          prev.top === bestStyle!.top &&\n          prev.left === bestStyle!.left &&\n          !(\"transform\" in prev)\n        ) {\n          return prev;\n        }\n        return bestStyle!;\n      });\n      return;\n    }\n\n    setBubbleStyle((prev) => (prev === DEFAULT_BUBBLE_STYLE ? prev : DEFAULT_BUBBLE_STYLE));\n  }, [anchor, bubbleSize, chat.pointer]);\n\n  const isSubmitting = chat.status === \"submitting\";\n  const hasInput = chat.instruction.trim().length > 0;\n  const showExpandedLayout = hasInput || chat.status !== \"idle\";\n  const disableEditing = isSubmitting;\n  const computedStatusLabel =\n    chat.statusLabel ?? statusSequence[chat.statusPhase] ?? statusSequence[0] ?? null;\n\n  const handleUndo = useCallback(() => {\n    if (chat.statusAddonMode !== \"summary\") {\n      return;\n    }\n\n    window.dispatchEvent(\n      new CustomEvent(EVENT_UNDO, {\n        detail: {\n          instruction: chat.instruction,\n          summary: chat.summary ?? null,\n          filePath: chat.filePath,\n        },\n      }),\n    );\n  }, [chat]);\n\n  useEffect(() => {\n    const textarea = textareaRef.current;\n    if (!textarea) return;\n\n    const minRows = showExpandedLayout ? 2 : 1;\n    textarea.rows = minRows;\n    textarea.style.height = \"auto\";\n    const computedStyles = window.getComputedStyle(textarea);\n    const lineHeight = parseFloat(computedStyles.lineHeight) || 24;\n    const borderOffset = textarea.offsetHeight - textarea.clientHeight;\n    const minHeight = lineHeight * minRows + borderOffset;\n    textarea.style.height = `${Math.max(textarea.scrollHeight, minHeight)}px`;\n  }, [chat.instruction, showExpandedLayout]);\n\n  const handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLTextAreaElement>) => {\n      if (event.key !== \"Enter\") return;\n      if (event.shiftKey) {\n        return;\n      }\n      event.preventDefault();\n      if (!isSubmitting && hasInput) {\n        onSubmit();\n      }\n    },\n    [hasInput, isSubmitting, onSubmit],\n  );\n\n  const handleChange = useCallback(\n    (event: ChangeEvent<HTMLTextAreaElement>) => {\n      onInstructionChange(event.target.value);\n    },\n    [onInstructionChange],\n  );\n\n  return (\n    <div\n      ref={bubbleRef}\n      style={bubbleStyle}\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-label=\"Shipflow overlay request\"\n      data-react-grab-chat-bubble=\"true\"\n      data-react-grab=\"true\"\n    >\n      <div\n        data-sf-body=\"true\"\n        data-expanded={showExpandedLayout ? \"true\" : \"false\"}\n      >\n        <div data-sf-row=\"input\">\n          <textarea\n            ref={textareaRef}\n            data-react-grab-chat-input=\"true\"\n            rows={showExpandedLayout ? 2 : 1}\n            placeholder=\"Change anything\"\n            value={chat.instruction}\n            onChange={handleChange}\n            onKeyDown={handleKeyDown}\n            disabled={disableEditing}\n            data-sf-input=\"true\"\n            data-expanded={showExpandedLayout ? \"true\" : \"false\"}\n          />\n\n          {!showExpandedLayout ? (\n            <button\n              type=\"button\"\n              onClick={onSubmit}\n              disabled={!hasInput || isSubmitting}\n              data-sf-inline-submit=\"true\"\n            >\n              <ArrowUp />\n            </button>\n          ) : null}\n        </div>\n\n        {showExpandedLayout ? (\n          <div data-sf-toolbar=\"true\">\n            <div data-sf-select-wrapper=\"true\">\n              <select\n                aria-label=\"Model selection\"\n                value={chat.model}\n                onChange={(event) => onModelChange(event.target.value)}\n                disabled={disableEditing}\n                data-sf-select=\"true\"\n              >\n                {modelOptions.map((option) => (\n                  <option key={option.value} value={option.value}>\n                    {option.label}\n                  </option>\n                ))}\n              </select>\n              <span data-sf-select-chevron=\"true\">\n                <svg width=\"10\" height=\"6\" viewBox=\"0 0 10 6\" fill=\"none\">\n                  <path d=\"M1 1l4 4 4-4\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n                </svg>\n              </span>\n            </div>\n\n            <button\n              type=\"button\"\n              onClick={isSubmitting ? onStop : onSubmit}\n              disabled={!hasInput && !isSubmitting}\n              data-sf-submit=\"true\"\n              data-hidden={!hasInput && !isSubmitting ? \"true\" : \"false\"}\n              data-submitting={isSubmitting ? \"true\" : \"false\"}\n            >\n              {isSubmitting ? (\n                <Square />\n              ) : (\n                <ArrowUp />\n              )}\n            </button>\n          </div>\n        ) : null}\n      </div>\n\n      {chat.statusAddonMode !== \"idle\" && (\n        <div\n          data-sf-status=\"true\"\n          data-mode={chat.statusAddonMode}\n        >\n          {chat.statusAddonMode === \"progress\" ? (\n            <div data-sf-status-header=\"true\">\n              <div data-sf-status-label=\"true\">\n                <CursorIcon loading />\n                <span data-sf-shimmer=\"true\">\n                  {computedStatusLabel}\n                </span>\n              </div>\n              {chat.statusContext && (\n                <span data-sf-status-context=\"true\">\n                  {chat.useTypewriter ? <Typewriter text={chat.statusContext} /> : chat.statusContext}\n                </span>\n              )}\n            </div>\n          ) : chat.statusAddonMode === \"summary\" && chat.summary ? (\n            <div data-sf-status-header=\"true\">\n              <div data-sf-status-label=\"true\">\n                <CursorIcon />\n                <span>Changes applied</span>\n              </div>\n              <div data-sf-undo-wrapper=\"true\">\n                <button\n                  type=\"button\"\n                  onClick={handleUndo}\n                  data-sf-undo=\"true\"\n                >\n                  Undo <Command /> Z\n                </button>\n              </div>\n            </div>\n          ) : null}\n        </div>\n      )}\n\n      {chat.error ? (\n        <div data-sf-error=\"true\">\n          {chat.error}\n        </div>\n      ) : null}\n    </div>\n  );\n}\n\nexport function FlowOverlayProvider(props: FlowOverlayProps = {}) {\n  const [portalTarget, setPortalTarget] = useState<ShadowRoot | HTMLElement | null>(null);\n  const overlayContainerRef = useRef<HTMLElement | null>(null);\n\n  useEffect(() => {\n    const mount = getOrCreateOverlayMount();\n    if (!mount) return;\n\n    overlayContainerRef.current = mount.container;\n    if (mount.root instanceof ShadowRoot) {\n      ensureOverlayStyles(mount.root);\n    } else if (typeof document !== \"undefined\") {\n      ensureOverlayStyles(document);\n    }\n    setPortalTarget(mount.root);\n\n    return () => {\n      if (mount.container.childNodes.length === 0 && mount.container.isConnected) {\n        mount.container.remove();\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (typeof document === \"undefined\") return;\n    const container = overlayContainerRef.current;\n    if (!container) return;\n\n    const media = window.matchMedia(\"(prefers-color-scheme: dark)\");\n\n    const updateTheme = () => {\n      const docEl = document.documentElement;\n      const hasDark = docEl.classList.contains(\"dark\");\n      const hasLight = docEl.classList.contains(\"light\");\n      const isDark = hasDark || (!hasLight && media.matches);\n      container.dataset.theme = isDark ? \"dark\" : \"light\";\n    };\n\n    updateTheme();\n\n    const observer = new MutationObserver(updateTheme);\n    observer.observe(document.documentElement, { attributes: true, attributeFilter: [\"class\"] });\n    media.addEventListener(\"change\", updateTheme);\n\n    return () => {\n      observer.disconnect();\n      media.removeEventListener(\"change\", updateTheme);\n    };\n  }, [portalTarget]);\n\n  const clipboardOptions = useMemo(\n    () => props.clipboardOptions ?? {},\n    [props.clipboardOptions],\n  );\n\n  const config = useMemo<ShipflowOverlayConfig>(() => {\n    const models =\n      props.models && props.models.length > 0 ? props.models : DEFAULT_CONFIG.models;\n    const statusSequence =\n      props.statusSequence && props.statusSequence.length > 0\n        ? props.statusSequence\n        : DEFAULT_CONFIG.statusSequence;\n    const endpoint = props.endpoint ?? DEFAULT_CONFIG.endpoint;\n\n    return {\n      endpoint,\n      models,\n      statusSequence,\n    };\n  }, [props.endpoint, props.models, props.statusSequence]);\n\n  const [chat, setChat] = useState<ChatState | null>(null);\n  const abortControllerRef = useRef<AbortController | null>(null);\n  const fallbackStatusLabel = config.statusSequence[0] ?? null;\n\n  useEffect(() => {\n    if (props.enableClipboardInterceptor === false) {\n      return;\n    }\n\n    let cleanup: (() => void) | undefined;\n\n    loadReactGrabRuntime({\n      url: clipboardOptions.reactGrabUrl,\n    })\n      .then(() => {\n        cleanup = registerClipboardInterceptor({\n          projectRoot: clipboardOptions.projectRoot,\n          highlightColor: clipboardOptions.highlightColor,\n          highlightStyleId: clipboardOptions.highlightStyleId,\n          logClipboardEndpoint:\n            clipboardOptions.logClipboardEndpoint ??\n            process.env.SHIPFLOW_OVERLAY_LOG_ENDPOINT ??\n            null,\n          reactGrabUrl: clipboardOptions.reactGrabUrl,\n        });\n      })\n      .catch((error) => {\n        console.error(\"[shipflow-overlay] Failed to load React Grab runtime\", error);\n      });\n\n    return () => {\n      cleanup?.();\n    };\n  }, [\n    clipboardOptions.highlightColor,\n    clipboardOptions.highlightStyleId,\n    clipboardOptions.logClipboardEndpoint,\n    clipboardOptions.projectRoot,\n    clipboardOptions.reactGrabUrl,\n    props.enableClipboardInterceptor,\n  ]);\n\n  const close = useCallback(() => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n      abortControllerRef.current = null;\n    }\n    setChat(null);\n    window.dispatchEvent(new Event(EVENT_CLOSE));\n  }, []);\n\n  const buildInitialState = useCallback(\n    () => createInitialState(config.models, config.statusSequence),\n    [config.models, config.statusSequence],\n  );\n\n  useSelectionEvents(\n    useCallback(\n      (payload: SelectionPayload) => {\n        setChat({\n          ...buildInitialState(),\n          ...payload,\n        });\n      },\n      [buildInitialState],\n    ),\n    close,\n    Boolean(chat),\n  );\n\n  useRecalculateRect(chat, setChat);\n  useEscapeToClose(Boolean(chat), close);\n  useAutoFocus(Boolean(chat), portalTarget);\n\n  const sendToBackend = useCallback(\n    async (payload: {\n      filePath: string | null;\n      htmlFrame: string | null;\n      stackTrace: string | null;\n      instruction: string;\n      model: string;\n    }) => {\n      const controller = new AbortController();\n      abortControllerRef.current = controller;\n\n      const promotePhase = (phase: number) => {\n        const safePhase = Math.min(Math.max(phase, 0), config.statusSequence.length - 1);\n        setChat((prev) => {\n          if (!prev) return prev;\n          if (prev.statusPhase === safePhase && prev.statusLabel) {\n            return prev;\n          }\n          return {\n            ...prev,\n            statusPhase: safePhase,\n            statusLabel: config.statusSequence[safePhase] ?? fallbackStatusLabel,\n          };\n        });\n      };\n\n      try {\n        const response = await fetch(config.endpoint, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          signal: controller.signal,\n          body: JSON.stringify(payload),\n        });\n\n        if (!response.ok) {\n          const data = await response.json().catch(() => null);\n          throw new Error(data?.error ?? `Request failed with status ${response.status}`);\n        }\n\n        const reader = response.body?.getReader();\n        if (!reader) {\n          throw new Error(\"Streaming response is not supported in this environment.\");\n        }\n\n        const decoder = new TextDecoder();\n        let buffer = \"\";\n        let assistantSummary = \"\";\n        let hasPromotedPlanning = false;\n        let hasPromotedUpdating = false;\n\n        const processEvent = (event: StreamEvent) => {\n          if (event.event === \"status\") {\n            const message = event.message?.trim();\n            if (message) {\n              if (!hasPromotedPlanning && /plan|analy/i.test(message)) {\n                promotePhase(1);\n                hasPromotedPlanning = true;\n              }\n              if (!hasPromotedUpdating && /apply|build|final|update/i.test(message)) {\n                promotePhase(2);\n                hasPromotedUpdating = true;\n              }\n              setChat((prev) =>\n                prev\n                  ? {\n                      ...prev,\n                      statusContext: message,\n                      useTypewriter: true,\n                    }\n                  : prev,\n              );\n            }\n            if (!hasPromotedPlanning) {\n              promotePhase(0);\n            }\n            return;\n          }\n\n          if (event.event === \"assistant\") {\n            const chunk = event.text?.trim();\n            if (chunk) {\n              assistantSummary += chunk.endsWith(\"\\n\") ? chunk : `${chunk} `;\n              if (!hasPromotedPlanning) {\n                promotePhase(1);\n                hasPromotedPlanning = true;\n              }\n              setChat((prev) =>\n                prev\n                  ? {\n                      ...prev,\n                      statusContext: chunk,\n                      useTypewriter: false,\n                    }\n                  : prev,\n              );\n            }\n            return;\n          }\n\n          if (event.event === \"done\") {\n            if (event.success) {\n              promotePhase(2);\n              hasPromotedUpdating = true;\n              const summary =\n                event.summary?.trim() || assistantSummary.trim() || \"Changes applied.\";\n              setChat((prev) =>\n                prev\n                  ? {\n                      ...prev,\n                      status: \"success\",\n                      instruction: \"\",\n                      statusAddonMode: \"summary\",\n                      summary,\n                      statusLabel: null,\n                      statusContext: null,\n                      statusPhase: Math.max(config.statusSequence.length - 1, 0),\n                      serverMessage: event.stderr ? event.stderr.trim() : prev.serverMessage,\n                    }\n                  : prev,\n              );\n            } else {\n              setChat((prev) =>\n                prev\n                  ? {\n                      ...prev,\n                      status: \"error\",\n                      error: event.error ?? \"Cursor CLI reported an error.\",\n                      statusAddonMode: \"idle\",\n                      statusLabel: null,\n                      statusContext: null,\n                      summary: undefined,\n                      statusPhase: 0,\n                      serverMessage: event.stderr ? event.stderr.trim() : prev.serverMessage,\n                    }\n                  : prev,\n              );\n            }\n          }\n        };\n\n        while (true) {\n          const { done, value } = await reader.read();\n          if (done) {\n            break;\n          }\n\n          buffer += decoder.decode(value, { stream: true });\n          let newlineIndex = buffer.indexOf(\"\\n\");\n\n          while (newlineIndex !== -1) {\n            const line = buffer.slice(0, newlineIndex).trim();\n            buffer = buffer.slice(newlineIndex + 1);\n            if (line) {\n              try {\n                processEvent(JSON.parse(line) as StreamEvent);\n              } catch (error) {\n                console.warn(\"[shipflow-overlay] Unable to parse stream line\", { line, error });\n              }\n            }\n            newlineIndex = buffer.indexOf(\"\\n\");\n          }\n        }\n\n        buffer += decoder.decode();\n        const finalLine = buffer.trim();\n        if (finalLine) {\n          try {\n            processEvent(JSON.parse(finalLine) as StreamEvent);\n          } catch (error) {\n            console.warn(\"[shipflow-overlay] Unable to parse final stream line\", { finalLine, error });\n          }\n        }\n      } catch (error) {\n        if (controller.signal.aborted) {\n          setChat((prev) =>\n            prev\n              ? {\n                  ...prev,\n                  status: \"idle\",\n                  statusAddonMode: \"idle\",\n                  statusLabel: null,\n                  statusContext: null,\n                  summary: undefined,\n                  error: undefined,\n                  serverMessage: undefined,\n                  statusPhase: 0,\n                }\n              : prev,\n          );\n          return;\n        }\n\n        console.error(\"[shipflow-overlay] Failed to communicate with Cursor CLI backend\", error);\n        setChat((prev) =>\n          prev\n            ? {\n                ...prev,\n                status: \"error\",\n                error: error instanceof Error ? error.message : \"Unable to send request.\",\n                statusAddonMode: \"idle\",\n                statusLabel: null,\n                statusContext: null,\n                summary: undefined,\n              }\n            : prev,\n        );\n      } finally {\n        if (abortControllerRef.current === controller) {\n          abortControllerRef.current = null;\n        }\n      }\n    },\n    [config.endpoint, config.models, config.statusSequence, fallbackStatusLabel],\n  );\n\n  const onInstructionChange = useCallback((value: string) => {\n    setChat((current) => {\n      if (!current) {\n        return current;\n      }\n\n      const next: ChatState = {\n        ...current,\n        instruction: value,\n      };\n\n      if (current.status !== \"submitting\") {\n        next.status = \"idle\";\n      }\n\n      if (value.length > 0 && current.statusAddonMode !== \"idle\") {\n        next.statusAddonMode = \"idle\";\n        next.statusLabel = null;\n        next.statusContext = null;\n        next.summary = undefined;\n        next.statusPhase = 0;\n      }\n\n      if (current.status === \"error\") {\n        next.error = undefined;\n      }\n\n      return next;\n    });\n  }, []);\n\n  const onSubmit = useCallback(() => {\n    let payload:\n      | {\n          filePath: string | null;\n          htmlFrame: string | null;\n          stackTrace: string | null;\n          instruction: string;\n          model: string;\n        }\n      | null = null;\n\n    setChat((current) => {\n      if (!current) return current;\n      if (current.status === \"submitting\") return current;\n\n      const trimmed = current.instruction.trim();\n      if (!trimmed) {\n        return {\n          ...current,\n          error: \"Please describe the change.\",\n          status: \"error\",\n          statusAddonMode: \"idle\",\n          statusLabel: null,\n          statusContext: null,\n          summary: undefined,\n          statusPhase: 0,\n          serverMessage: undefined,\n        };\n      }\n\n      payload = {\n        filePath: current.filePath,\n        htmlFrame: current.htmlFrame,\n        stackTrace: current.codeLocation,\n        instruction: trimmed,\n        model: current.model || config.models[0]?.value || \"\",\n      };\n\n      return {\n        ...current,\n        instruction: trimmed,\n        status: \"submitting\",\n        error: undefined,\n        serverMessage: undefined,\n        statusAddonMode: \"progress\",\n        statusLabel: config.statusSequence[0] ?? fallbackStatusLabel,\n        statusContext: \"Preparing Cursor CLI requestâ€¦\",\n        summary: undefined,\n        statusPhase: 0,\n      };\n    });\n\n    if (payload) {\n      void sendToBackend(payload);\n    }\n  }, [config.models, config.statusSequence, fallbackStatusLabel, sendToBackend]);\n\n  const stop = useCallback(() => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n    }\n  }, []);\n\n  const onModelChange = useCallback(\n    (value: string) => {\n      setChat((current) => {\n        if (!current || current.status === \"submitting\") {\n          return current;\n        }\n        const nextValue = config.models.some((option) => option.value === value)\n          ? value\n          : config.models[0]?.value ?? \"\";\n        return { ...current, model: nextValue };\n      });\n    },\n    [config.models],\n  );\n\n  if (!portalTarget || !chat) {\n    return null;\n  }\n\n  return createPortal(\n    <Bubble\n      chat={chat}\n      onInstructionChange={onInstructionChange}\n      onSubmit={onSubmit}\n      onStop={stop}\n      onModelChange={onModelChange}\n      onClose={close}\n      modelOptions={config.models}\n      statusSequence={config.statusSequence}\n    />,\n    portalTarget,\n  );\n}\n\nexport { Typewriter };\n\n\n\n","export const DEFAULT_STATUS_SEQUENCE = [\n  \"Thinking\",\n  \"Planning next moves\",\n  \"Updating UI\",\n] as const;\n\nexport const DEFAULT_MODEL_OPTIONS = [\n  { value: \"composer-1\", label: \"Composer 1\" },\n  { value: \"gpt-5\", label: \"GPT-5\" },\n  { value: \"sonnet-4.5\", label: \"Sonnet 4.5\" },\n  { value: \"gemini-3\", label: \"Gemini 3\" },\n] as const;\n\n\n\n","const DEFAULT_SCRIPT_URL = \"https://unpkg.com/react-grab@0.0.51/dist/index.global.js\";\nconst GLOBAL_FLAG = \"__shipflowReactGrabLoaded\";\n\ntype LoadOptions = {\n  url?: string;\n};\n\nlet pendingLoad: Promise<void> | null = null;\n\nexport function loadReactGrabRuntime(options: LoadOptions = {}): Promise<void> {\n  if (typeof window === \"undefined\") {\n    return Promise.resolve();\n  }\n\n  if ((window as unknown as Record<string, unknown>)[GLOBAL_FLAG]) {\n    return Promise.resolve();\n  }\n\n  if (pendingLoad) {\n    return pendingLoad;\n  }\n\n  const scriptUrl = options.url ?? DEFAULT_SCRIPT_URL;\n\n  pendingLoad = new Promise<void>((resolve, reject) => {\n    const existing = Array.from(document.scripts).find((script) => script.src === scriptUrl);\n    if (existing) {\n      (window as unknown as Record<string, unknown>)[GLOBAL_FLAG] = true;\n      pendingLoad = null;\n      resolve();\n      return;\n    }\n\n    const script = document.createElement(\"script\");\n    script.src = scriptUrl;\n    script.crossOrigin = \"anonymous\";\n    script.async = false;\n    script.onload = () => {\n      (window as unknown as Record<string, unknown>)[GLOBAL_FLAG] = true;\n      pendingLoad = null;\n      resolve();\n    };\n    script.onerror = (error) => {\n      pendingLoad = null;\n      reject(error instanceof ErrorEvent ? error.error : error);\n    };\n    document.head.appendChild(script);\n  });\n\n  return pendingLoad;\n}\n\n\n\n","import { loadReactGrabRuntime } from \"./loadReactGrabRuntime\";\nimport type { SelectionPayload } from \"./types\";\n\nconst GLOBAL_KEY = \"__shipflowOverlayCleanup\";\nconst HIGHLIGHT_ATTR = \"data-react-grab-chat-highlighted\";\nconst STYLE_ID = \"shipflow-overlay-highlight-style\";\nconst EVENT_OPEN = \"react-grab-chat:open\";\nconst EVENT_CLOSE = \"react-grab-chat:close\";\n\ntype ClipboardParseResult = {\n  htmlFrame: string | null;\n  codeLocation: string | null;\n};\n\nexport type ClipboardInterceptorOptions = {\n  projectRoot?: string;\n  highlightColor?: string;\n  highlightStyleId?: string;\n  logClipboardEndpoint?: string | null;\n  reactGrabUrl?: string;\n};\n\nconst defaultOptions: Required<Pick<ClipboardInterceptorOptions, \"highlightColor\" | \"highlightStyleId\">> =\n  {\n    highlightColor: \"#ff40e0\",\n    highlightStyleId: STYLE_ID,\n  };\n\nfunction ensureHighlightStyles(color: string, styleId: string) {\n  if (document.getElementById(styleId)) return;\n  const style = document.createElement(\"style\");\n  style.id = styleId;\n  style.textContent = `\n[${HIGHLIGHT_ATTR}=\"true\"] {\n  outline: 2px solid ${color};\n  outline-offset: 2px;\n  transition: outline 0.2s ease;\n}`;\n  document.head.appendChild(style);\n}\n\nfunction parseClipboard(text: string): ClipboardParseResult {\n  if (typeof text !== \"string\") {\n    return { htmlFrame: null, codeLocation: null };\n  }\n  const htmlFrameMatch = text.match(/## HTML Frame:\\n([\\s\\S]*?)(?=\\n## Code Location:|$)/);\n  const codeLocationMatch = text.match(/## Code Location:\\n([\\s\\S]*?)(?=\\n<\\/selected_element>|$)/);\n  const selectedElementMatch = text.match(/<selected_element>\\n([\\s\\S]*?)\\n<\\/selected_element>/);\n  const htmlFrame = htmlFrameMatch\n    ? htmlFrameMatch[1].trim()\n    : selectedElementMatch\n      ? selectedElementMatch[1].trim()\n      : null;\n  const codeLocation = codeLocationMatch ? codeLocationMatch[1].trim() : null;\n  return { htmlFrame, codeLocation };\n}\n\nfunction extractFilePath(stack: string | null): string | null {\n  if (typeof stack !== \"string\") return null;\n\n  // Try multiple patterns to handle different formats from react-grab\n  const patterns = [\n    // Format: \"in Component (path/to/file.tsx:10:5)\" or \"at Component (path/to/file.tsx:10:5)\"\n    /\\b(?:in|at)\\s+\\S+\\s*\\(([^()]+?\\.(?:[jt]sx?|mdx?))(?::\\d+)*\\)/gi,\n    // Format: \"in path/to/file.tsx\" or \"at path/to/file.tsx\"\n    /\\b(?:in|at)\\s+((?:[A-Za-z]:)?[^\\s:()]+?\\.(?:[jt]sx?|mdx?))/gi,\n    // Format: just \"(path/to/file.tsx:10:5)\" in parentheses\n    /\\(([^()]+?\\.(?:[jt]sx?|mdx?))(?::\\d+)*\\)/gi,\n    // Format: bare path like \"app/page.tsx\" or \"./app/page.tsx\"\n    /(?:^|\\s)((?:\\.\\/)?(?:[A-Za-z]:)?[^\\s:()]+?\\.(?:[jt]sx?|mdx?))/gim,\n  ];\n\n  for (const pattern of patterns) {\n    pattern.lastIndex = 0;\n    let match: RegExpExecArray | null = null;\n    while ((match = pattern.exec(stack))) {\n      const candidate = match[1]?.trim();\n      if (!candidate) continue;\n      // Skip node_modules paths\n      if (candidate.includes(\"node_modules\")) continue;\n      // Skip if it looks like a URL\n      if (candidate.includes(\"://\")) continue;\n      return candidate;\n    }\n  }\n\n  return null;\n}\n\nfunction toRelativePath(filePath: string | null, projectRoot?: string): string | null {\n  if (!filePath) return null;\n  if (!projectRoot) return filePath;\n  const normalizedRoot = projectRoot.endsWith(\"/\")\n    ? projectRoot\n    : `${projectRoot}/`;\n  if (filePath.startsWith(normalizedRoot)) {\n    const sliced = filePath.slice(normalizedRoot.length);\n    return sliced.startsWith(\"/\") ? sliced.slice(1) : sliced;\n  }\n  return filePath;\n}\n\ntype Pointer = { clientX: number; clientY: number };\n\nfunction findElementAtPoint(clientX: number, clientY: number): HTMLElement | null {\n  const elements = document.elementsFromPoint(clientX, clientY);\n  for (const element of elements) {\n    if (!(element instanceof HTMLElement)) continue;\n    if (element.closest?.(\"[data-react-grab]\")) continue;\n    const style = window.getComputedStyle(element);\n    if (\n      style.pointerEvents === \"none\" ||\n      style.visibility === \"hidden\" ||\n      style.display === \"none\" ||\n      Number(style.opacity) === 0\n    ) {\n      continue;\n    }\n    return element;\n  }\n  return null;\n}\n\nfunction findTooltipElement(): HTMLElement | null {\n  const OVERLAY_SELECTOR = \"[data-react-grab=\\\"true\\\"]\";\n  const TOOLTIP_SELECTOR = \"div.pointer-events-none.bg-grab-pink-light.text-grab-pink\";\n  const visited = new Set<Node>();\n\n  const visit = (node: Node | null): HTMLElement | null => {\n    if (!node || visited.has(node)) {\n      return null;\n    }\n    visited.add(node);\n\n    if (node instanceof HTMLElement || node instanceof DocumentFragment) {\n      const queryMatch =\n        node instanceof HTMLElement ? node.querySelector<HTMLElement>(TOOLTIP_SELECTOR) : null;\n      if (queryMatch) {\n        return queryMatch;\n      }\n      const children = node instanceof HTMLElement ? Array.from(node.children) : [];\n      for (const child of children) {\n        const found = visit(child);\n        if (found) {\n          return found;\n        }\n      }\n    }\n\n    if (node instanceof HTMLElement && node.shadowRoot) {\n      return visit(node.shadowRoot);\n    }\n\n    return null;\n  };\n\n  const hosts = document.querySelectorAll<HTMLElement>(OVERLAY_SELECTOR);\n  for (const host of hosts) {\n    const found = visit(host) ?? (host.shadowRoot ? visit(host.shadowRoot) : null);\n    if (found) {\n      return found;\n    }\n  }\n  return null;\n}\n\nfunction getHoverTagRect():\n  | {\n      top: number;\n      left: number;\n      width: number;\n      height: number;\n    }\n  | null {\n  const tooltip = findTooltipElement();\n  if (!(tooltip instanceof HTMLElement)) {\n    return null;\n  }\n  const rect = tooltip.getBoundingClientRect();\n  if (rect.width === 0 && rect.height === 0) {\n    return null;\n  }\n  return {\n    top: rect.top,\n    left: rect.left,\n    width: rect.width,\n    height: rect.height,\n  };\n}\n\nfunction applyHighlight(element: HTMLElement | null) {\n  if (!element) return;\n  const previous = document.querySelector<HTMLElement>(`[${HIGHLIGHT_ATTR}=\"true\"]`);\n  if (previous && previous !== element) {\n    previous.removeAttribute(HIGHLIGHT_ATTR);\n  }\n  element.setAttribute(HIGHLIGHT_ATTR, \"true\");\n}\n\nfunction clearHighlight() {\n  const highlighted = document.querySelector<HTMLElement>(`[${HIGHLIGHT_ATTR}=\"true\"]`);\n  highlighted?.removeAttribute(HIGHLIGHT_ATTR);\n}\n\nfunction dispatchOpenEvent(detail: SelectionPayload & { tagRect: unknown }) {\n  window.dispatchEvent(\n    new CustomEvent(EVENT_OPEN, {\n      detail,\n    }),\n  );\n}\n\nexport function registerClipboardInterceptor(\n  options: ClipboardInterceptorOptions = {},\n): () => void {\n  if (typeof window === \"undefined\" || typeof navigator === \"undefined\") {\n    return () => undefined;\n  }\n\n  if ((window as unknown as Record<string, () => void>)[GLOBAL_KEY]) {\n    return (window as unknown as Record<string, () => void>)[GLOBAL_KEY];\n  }\n\n  if (!navigator.clipboard || typeof navigator.clipboard.writeText !== \"function\") {\n    console.warn(\"[shipflow-overlay] navigator.clipboard.writeText is not available.\");\n    return () => undefined;\n  }\n\n  const projectRoot = options.projectRoot;\n  const highlightColor = options.highlightColor ?? defaultOptions.highlightColor;\n  const highlightStyleId = options.highlightStyleId ?? defaultOptions.highlightStyleId;\n  const logClipboardEndpoint =\n    options.logClipboardEndpoint === undefined ? null : options.logClipboardEndpoint;\n\n  ensureHighlightStyles(highlightColor, highlightStyleId);\n  clearHighlight();\n  void loadReactGrabRuntime({ url: options.reactGrabUrl });\n\n  let lastPointer: Pointer | null = null;\n\n  const pointerListener = (event: Event) => {\n    const pointer = event as PointerEvent;\n    lastPointer = { clientX: pointer.clientX, clientY: pointer.clientY };\n  };\n\n  window.addEventListener(\"pointerup\", pointerListener, true);\n  window.addEventListener(EVENT_CLOSE, clearHighlight);\n\n  const originalWriteText = navigator.clipboard.writeText.bind(navigator.clipboard);\n\n  const overrideWriteText = async function (text: string) {\n    const parsed = parseClipboard(text);\n    const isReactGrabPayload = Boolean(parsed.htmlFrame || parsed.codeLocation);\n\n    const result = await originalWriteText(text);\n\n    if (!isReactGrabPayload) {\n      return result;\n    }\n\n    const pointer = lastPointer;\n    lastPointer = null;\n    const pointerPayload = pointer ? { x: pointer.clientX, y: pointer.clientY } : null;\n\n    let boundingRect: SelectionPayload[\"boundingRect\"] = null;\n    let element: HTMLElement | null = null;\n\n    if (pointer) {\n      element = findElementAtPoint(pointer.clientX, pointer.clientY);\n    }\n\n    if (!element) {\n      const fallback = document.querySelector<HTMLElement>(`[${HIGHLIGHT_ATTR}=\"true\"]`);\n      if (fallback) {\n        element = fallback;\n      }\n    }\n\n    if (element instanceof HTMLElement) {\n      applyHighlight(element);\n      const rect = element.getBoundingClientRect();\n      boundingRect = {\n        top: rect.top,\n        left: rect.left,\n        width: rect.width,\n        height: rect.height,\n      };\n    }\n\n    let filePath = parsed.codeLocation ? extractFilePath(parsed.codeLocation) : null;\n    filePath = filePath ? toRelativePath(filePath, projectRoot) : null;\n\n    const tagRect = getHoverTagRect();\n\n    dispatchOpenEvent({\n      htmlFrame: parsed.htmlFrame,\n      codeLocation: parsed.codeLocation,\n      filePath,\n      clipboardData: text,\n      pointer: pointerPayload,\n      boundingRect,\n      tagRect,\n    } as SelectionPayload & { tagRect: unknown });\n\n    if (logClipboardEndpoint) {\n      try {\n        await fetch(logClipboardEndpoint, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            clipboardData: text,\n            timestamp: new Date().toISOString(),\n            filePath,\n          }),\n        });\n      } catch (error) {\n        console.error(\"[shipflow-overlay] Failed to log clipboard payload\", error);\n      }\n    }\n\n    return result;\n  };\n\n  navigator.clipboard.writeText = overrideWriteText;\n\n  const cleanup = () => {\n    window.removeEventListener(\"pointerup\", pointerListener, true);\n    window.removeEventListener(EVENT_CLOSE, clearHighlight);\n    if ((navigator.clipboard.writeText as unknown) === overrideWriteText) {\n      navigator.clipboard.writeText = originalWriteText;\n    }\n    clearHighlight();\n    delete (window as unknown as Record<string, () => void>)[GLOBAL_KEY];\n  };\n\n  (window as unknown as Record<string, () => void>)[GLOBAL_KEY] = cleanup;\n  return cleanup;\n}\n\n\n\n"],"mappings":"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AA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA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","names":["script","EVENT_OPEN","EVENT_CLOSE","_a","_b"]}