{"version":3,"sources":["../src/server/createNextHandler.ts","../src/next.ts"],"sourcesContent":["import type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport type { StreamEvent } from \"../runtime/types\";\n// Import constants, including STREAM_HEADERS\nimport { STREAM_HEADERS } from \"../runtime/constants\";\n\nexport type ShipflowOverlayRequestPayload = {\n  filePath: string | null;\n  htmlFrame: string | null;\n  stackTrace: string | null;\n  instruction: string;\n  model?: string;\n};\n\nexport type ShipflowOverlayServerOptions = {\n  cursorAgentBinary?: string;\n  additionalSearchDirs?: string[];\n  defaultModel?: string;\n  allowInProduction?: boolean;\n  timeoutMs?: number;\n  logPrefix?: string;\n};\n\nconst DEFAULT_MODEL = \"composer-1\";\n\n// Edge-runtime-compatible path utilities (no Node.js path module required)\nconst isAbsolutePath = (p: string): boolean => {\n  // Unix absolute path\n  if (p.startsWith(\"/\")) return true;\n  // Windows absolute path (e.g., C:\\ or C:/)\n  if (/^[A-Za-z]:[\\\\/]/.test(p)) return true;\n  return false;\n};\n\nconst normalizeSeparators = (p: string): string => p.replace(/\\\\/g, \"/\");\n\nconst getRelativePath = (from: string, to: string): string => {\n  const fromParts = normalizeSeparators(from).split(\"/\").filter(Boolean);\n  const toParts = normalizeSeparators(to).split(\"/\").filter(Boolean);\n\n  // Find common prefix length\n  let commonLength = 0;\n  const minLength = Math.min(fromParts.length, toParts.length);\n  for (let i = 0; i < minLength; i++) {\n    if (fromParts[i] === toParts[i]) {\n      commonLength++;\n    } else {\n      break;\n    }\n  }\n\n  // Build relative path\n  const upCount = fromParts.length - commonLength;\n  const downParts = toParts.slice(commonLength);\n  const relativeParts = [...Array(upCount).fill(\"..\"), ...downParts];\n\n  return relativeParts.join(\"/\") || \".\";\n};\n\n// Multiple patterns to extract file paths from various stack trace formats\nconst STACK_TRACE_PATTERNS = [\n  // Format: \"in Component (path/to/file.tsx:10:5)\" or \"at Component (path/to/file.tsx:10:5)\"\n  /\\b(?:in|at)\\s+\\S+\\s*\\(([^()]+?\\.(?:[jt]sx?|mdx?))(?::\\d+)*\\)/gi,\n  // Format: \"in path/to/file.tsx\" or \"at path/to/file.tsx\"\n  /\\b(?:in|at)\\s+((?:[A-Za-z]:)?[^\\s:()]+?\\.(?:[jt]sx?|mdx?))/gi,\n  // Format: just \"(path/to/file.tsx:10:5)\" in parentheses\n  /\\(([^()]+?\\.(?:[jt]sx?|mdx?))(?::\\d+)*\\)/gi,\n  // Format: bare path like \"app/page.tsx\" without surrounding context\n  /(?:^|\\s)((?:\\.\\/)?(?:[A-Za-z]:)?[^\\s:()]+?\\.(?:[jt]sx?|mdx?))/gim,\n];\n\nconst normalizeFilePath = (filePath: string | null) => {\n  if (!filePath) return null;\n  const trimmed = filePath.trim();\n  if (!trimmed) return null;\n\n  const webpackPrefix = \"webpack-internal:///\";\n  const filePrefix = \"file://\";\n  let sanitized = trimmed;\n  if (sanitized.startsWith(webpackPrefix)) {\n    sanitized = sanitized.slice(webpackPrefix.length);\n  }\n  if (sanitized.startsWith(filePrefix)) {\n    sanitized = sanitized.slice(filePrefix.length);\n  }\n  if (sanitized.startsWith(\"./\")) {\n    sanitized = sanitized.slice(2);\n  }\n\n  if (!sanitized) {\n    return null;\n  }\n\n  const cwd = process.cwd();\n  if (pathIsAbsoluteSafe(sanitized)) {\n    const relative = relativeSafe(cwd, sanitized);\n    return relative.startsWith(\"..\") ? sanitized : relative;\n  }\n\n  return sanitized;\n};\n\nconst pathIsAbsoluteSafe = (target: string) => {\n  try {\n    return isAbsolutePath(target);\n  } catch {\n    return false;\n  }\n};\n\nconst relativeSafe = (from: string, to: string) => {\n  try {\n    return getRelativePath(from, to);\n  } catch {\n    return to;\n  }\n};\n\nconst extractFilePathFromStackTrace = (stackTrace: string | null) => {\n  if (!stackTrace) return null;\n\n  // Try each pattern in order of specificity\n  for (const pattern of STACK_TRACE_PATTERNS) {\n    pattern.lastIndex = 0;\n    let match: RegExpExecArray | null;\n\n    while ((match = pattern.exec(stackTrace))) {\n      const rawCandidate = match[1];\n      if (typeof rawCandidate !== \"string\") {\n        continue;\n      }\n\n      let candidate = rawCandidate.trim();\n      if (!candidate) {\n        continue;\n      }\n\n      // Skip node_modules paths\n      if (candidate.includes(\"node_modules/\") || candidate.includes(\"node_modules\\\\\")) {\n        continue;\n      }\n\n      // Skip URLs\n      if (candidate.includes(\"://\")) {\n        continue;\n      }\n\n      // Clean up webpack prefixes\n      if (candidate.startsWith(\"webpack-internal:///\")) {\n        candidate = candidate.slice(\"webpack-internal:///\".length);\n      }\n\n      // Clean up relative path prefix\n      if (candidate.startsWith(\"./\")) {\n        candidate = candidate.slice(2);\n      }\n\n      // Strip line/column numbers at the end (e.g., \":10:5\")\n      candidate = candidate.replace(/:\\d+(?::\\d+)?$/, \"\");\n\n      if (!candidate) {\n        continue;\n      }\n\n      return candidate;\n    }\n  }\n\n  return null;\n};\n\nconst extractComponentNames = (stackTrace: string | null): string[] => {\n  if (!stackTrace) return [];\n  // Match \"at ComponentName (Server)\" or \"in ComponentName (Server)\" - PascalCase components only\n  const matches = stackTrace.matchAll(/\\b(?:at|in)\\s+([A-Z][a-zA-Z0-9]*)\\s*\\(Server\\)/g);\n  return [...matches].map((m) => m[1]).filter(Boolean);\n};\n\nconst buildPrompt = (\n  filePath: string | null,\n  htmlFrame: string | null,\n  stackTrace: string | null,\n  instruction: string,\n) => {\n  const lines: string[] = [];\n\n  if (filePath) {\n    lines.push(`Open ${filePath}.`);\n    lines.push(\"Target the element matching this HTML:\");\n    lines.push(htmlFrame ?? \"(no HTML frame provided)\");\n    lines.push(\"\");\n    lines.push(\"and the component stack:\");\n    lines.push(stackTrace ?? \"(no component stack provided)\");\n  } else {\n    // Fallback for RSC or when file path cannot be determined\n    lines.push(\"Find the file containing the component that renders this HTML:\");\n    lines.push(htmlFrame ?? \"(no HTML frame provided)\");\n    lines.push(\"\");\n    lines.push(\"Component stack (use component names to locate the file):\");\n    lines.push(stackTrace ?? \"(no component stack provided)\");\n\n    const componentNames = extractComponentNames(stackTrace);\n    if (componentNames.length > 0) {\n      lines.push(\"\");\n      lines.push(`Look for files defining these components: ${componentNames.join(\", \")}`);\n    }\n  }\n\n  lines.push(\"\");\n  lines.push(`User request: ${instruction}`);\n  return lines.join(\"\\n\");\n};\n\nconst stripNullish = <T extends Record<string, unknown>>(record: T): T =>\n  Object.fromEntries(\n    Object.entries(record).filter(([, value]) => value !== undefined && value !== null),\n  ) as T;\n\nconst isEnabled = (options: ShipflowOverlayServerOptions): boolean => {\n  if (options.allowInProduction) {\n    return true;\n  }\n  const envFlag = process.env.SHIPFLOW_OVERLAY_ENABLED;\n  if (envFlag && [\"true\", \"1\", \"on\", \"yes\"].includes(envFlag.toLowerCase())) {\n    return true;\n  }\n  return process.env.NODE_ENV === \"development\";\n};\n\nexport function createNextHandler(options: ShipflowOverlayServerOptions = {}) {\n  const logPrefix = options.logPrefix ?? \"[shipflow-overlay]\";\n\n  return async function handler(request: NextRequest) {\n    if (!isEnabled(options)) {\n      return NextResponse.json(\n        { error: \"Shipflow overlay workflow is only available in development.\" },\n        { status: 403 },\n      );\n    }\n\n    let payload: ShipflowOverlayRequestPayload;\n    try {\n      payload = (await request.json()) as ShipflowOverlayRequestPayload;\n    } catch {\n      return NextResponse.json({ error: \"Invalid JSON payload.\" }, { status: 400 });\n    }\n\n    const instruction = payload.instruction?.trim();\n    if (!instruction) {\n      return NextResponse.json({ error: \"Instruction is required.\" }, { status: 400 });\n    }\n\n    const directFilePath = normalizeFilePath(payload.filePath);\n    const derivedFilePath =\n      directFilePath ??\n      (payload.filePath\n        ? null\n        : normalizeFilePath(extractFilePathFromStackTrace(payload.stackTrace)));\n    const normalizedFilePath = derivedFilePath;\n\n    if (!normalizedFilePath) {\n      const truncatedStack = payload.stackTrace?.slice(0, 200) ?? \"(none)\";\n      console.warn(\n        `${logPrefix} No file path found, using fallback prompt. stackTrace snippet: ${truncatedStack}`,\n      );\n    }\n\n    // buildPrompt handles null filePath with a discovery-focused fallback prompt\n    const prompt = buildPrompt(normalizedFilePath, payload.htmlFrame, payload.stackTrace, instruction);\n    const model = payload.model?.trim() || options.defaultModel || DEFAULT_MODEL;\n\n    try {\n      // Dynamically import the cursor agent implementation to avoid bundling Node.js dependencies\n      // (child_process, fs) in the initial bundle. This helps prevent errors in Edge environments\n      // where these modules are not available, even if this handler is only used in Node.js routes.\n      const { resolveCursorAgentBinary, runCursorAgentStream } = await import(\"./cursorAgent\");\n\n      const resolved = await resolveCursorAgentBinary(\n        stripNullish({\n          binaryPath: options.cursorAgentBinary,\n          additionalSearchDirs: options.additionalSearchDirs,\n          logPrefix,\n        }),\n      );\n      const encoder = new TextEncoder();\n\n      const stream = new ReadableStream({\n        async start(controller) {\n          const state = { isClosed: false };\n\n          const send = (event: StreamEvent) => {\n            if (state.isClosed) {\n              return;\n            }\n            try {\n              controller.enqueue(encoder.encode(`${JSON.stringify(event)}\\n`));\n            } catch (error) {\n              if (\n                error instanceof TypeError &&\n                (error.message.includes(\"closed\") || error.message.includes(\"Invalid state\"))\n              ) {\n                state.isClosed = true;\n              }\n            }\n          };\n\n          request.signal.addEventListener(\"abort\", () => {\n            state.isClosed = true;\n            try {\n              controller.close();\n            } catch {\n              // ignore\n            }\n          });\n\n          send({ event: \"status\", message: \"Understanding user intent\" });\n\n          try {\n            await runCursorAgentStream(\n              {\n                binary: resolved.binary,\n                model,\n                prompt,\n                timeoutMs: options.timeoutMs,\n                logPrefix,\n                env: resolved.env,\n              },\n              send,\n            );\n          } catch (error) {\n            if (state.isClosed) {\n              return;\n            }\n            console.error(`${logPrefix} Failed during Cursor CLI streaming`, error);\n            send({\n              event: \"done\",\n              success: false,\n              summary: \"\",\n              exitCode: null,\n              error:\n                error instanceof Error\n                  ? error.message\n                  : \"Unexpected error streaming from Cursor CLI.\",\n            });\n          } finally {\n            if (!state.isClosed) {\n              try {\n                controller.close();\n              } catch {\n                // ignore\n              }\n              state.isClosed = true;\n            }\n          }\n        },\n      });\n\n      return new NextResponse(stream, {\n        headers: STREAM_HEADERS,\n      });\n    } catch (error) {\n      console.error(`${logPrefix} Failed to run cursor-agent`, error);\n      return NextResponse.json(\n        {\n          error:\n            error instanceof Error\n              ? error.message\n              : \"Failed to invoke Cursor CLI. Ensure cursor-agent is installed and available on PATH.\",\n        },\n        { status: 500 },\n      );\n    }\n  };\n}\n","import { createNextHandler, type ShipflowOverlayServerOptions } from \"./server/createNextHandler\";\n\ntype NextConfig = Record<string, unknown>;\n\nexport type ShipflowOverlayNextOptions = {\n  enableInProduction?: boolean;\n  reactGrabUrl?: string;\n  logClipboardEndpoint?: string;\n};\n\nexport function withShipflowOverlay<T extends NextConfig = NextConfig>(\n  config: T = {} as T,\n  options: ShipflowOverlayNextOptions = {},\n): T & NextConfig {\n  const enabled =\n    options.enableInProduction || process.env.NODE_ENV === \"development\";\n\n  const env: Record<string, string | undefined> = {\n    ...(config.env as Record<string, string | undefined> | undefined),\n    SHIPFLOW_OVERLAY_ENABLED: enabled ? \"true\" : \"false\",\n  };\n\n  if (options.reactGrabUrl) {\n    env.SHIPFLOW_OVERLAY_REACT_GRAB_URL = options.reactGrabUrl;\n  }\n\n  if (options.logClipboardEndpoint) {\n    env.SHIPFLOW_OVERLAY_LOG_ENDPOINT = options.logClipboardEndpoint;\n  }\n\n  const existingTranspile = Array.isArray(config.transpilePackages)\n    ? config.transpilePackages\n    : [];\n  const transpilePackages = Array.from(\n    new Set([...existingTranspile, \"@shipflow/overlay\"]),\n  );\n\n  return {\n    ...config,\n    env,\n    transpilePackages,\n  };\n}\n\nexport { createNextHandler, type ShipflowOverlayServerOptions };\n\n\n\n"],"mappings":"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","names":["_a"]}